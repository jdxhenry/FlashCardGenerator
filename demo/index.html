<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flashcard Generator</title>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;700&family=Roboto+Mono:wght@400;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,0..200" rel="stylesheet" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- html2canvas for download -->
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#3b82f6",
          },
          fontFamily: {
            display: ["Inter", "sans-serif"],
            serif: ["Merriweather", "serif"],
            mono: ["Roboto Mono", "monospace"],
            elegant: ["Playfair Display", "serif"],
          },
        },
      },
    }
  </script>

  <style>
    body { min-height: 100dvh; }
    .aspect-1-1 { aspect-ratio: 1/1; }
    .aspect-3-4 { aspect-ratio: 3/4; }
    .aspect-16-9 { aspect-ratio: 16/9; }
    .aspect-9-16 { aspect-ratio: 9/16; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

    /* Overlay arrows styling */
    .nav-overlay {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      padding: 12px;
      border-radius: 9999px;
      background: rgba(0,0,0,0.3);
      backdrop-filter: blur(8px);
      color: white;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 20;
    }

    .has-multiple #cardPreview:hover .nav-overlay {
      opacity: 0.7;
    }

    .has-multiple #cardPreview:hover .nav-overlay:hover {
      opacity: 1;
    }

    .has-multiple .nav-overlay.disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .has-multiple .nav-overlay {
      display: block !important;
    }
  </style>
</head>

<body class="bg-gray-100 flex flex-col">

  <!-- Preview Area -->
  <main class="flex-1 flex flex-col items-center justify-center p-8 pb-20">
    <div id="cardPreview" class="relative max-w-lg w-full bg-white rounded-3xl shadow-2xl overflow-hidden aspect-3-4 border-4 border-transparent group">
      <div id="bgLayer" class="absolute inset-0 bg-gradient-to-br from-purple-600 to-pink-600"></div>
      <div class="absolute inset-0 bg-white/10 backdrop-blur-[4px]"></div>

      <div class="relative z-10 flex flex-col justify-center items-center h-full px-8 py-12 text-center">
        <h1 id="previewTitle" class="font-bold leading-tight font-elegant text-white">
          Offline FlashCard Maker
        </h1>
        <p id="previewContent" class="mt-6 font-medium leading-relaxed font-display text-white">
          Simply enter your Title and Content, choose your color, font, and background, then click Download—you’re done!
        </p>
      </div>

      <div id="watermark" class="absolute bottom-4 left-4 opacity-50 hidden">
        <span class="text-lg font-bold text-white">@henry</span>
      </div>

      <!-- Overlay Navigation Arrows -->
      <button id="prevOverlay" class="nav-overlay left-4 disabled:opacity-30">
        <span class="material-symbols-outlined text-5xl">chevron_left</span>
      </button>
      <button id="nextOverlay" class="nav-overlay right-4 disabled:opacity-30">
        <span class="material-symbols-outlined text-5xl">chevron_right</span>
      </button>

      <!-- Download Button in bottom-right corner -->
      <button id="downloadBtn" class="absolute bottom-5 right-5 z-30 w-16 h-16 bg-white/90 backdrop-blur-md rounded-full shadow-2xl flex items-center justify-center hover:scale-110 active:scale-95 transition">
        <span class="material-symbols-outlined text-4xl text-primary">download</span>
      </button>
    </div>
  </main>

  <!-- Bottom Toolbar -->
  <div class="fixed bottom-0 left-0 right-0 z-40 bg-white/80 backdrop-blur-lg border-t border-gray-200/50 shadow-2xl">
    <div class="max-w-lg mx-auto px-4 py-3 flex justify-between items-center">
	
	   <button data-action="aspect" class="flex flex-col items-center gap-1 text-gray-700 hover:text-primary active:scale-95 transition">
        <span class="material-symbols-outlined text-2xl">aspect_ratio</span>
        <span class="text-xs font-medium">Ratio</span>
      </button>
	  
      <button data-action="edit" class="flex flex-col items-center gap-1 text-gray-700 hover:text-primary active:scale-95 transition">
        <span class="material-symbols-outlined text-2xl">edit_note</span>
        <span class="text-xs font-medium">Edit</span>
      </button>

      <button data-action="font" class="flex flex-col items-center gap-1 text-gray-700 hover:text-primary active:scale-95 transition">
        <span class="material-symbols-outlined text-2xl">text_fields</span>
        <span class="text-xs font-medium">Font</span>
      </button>

      <button data-action="textColor" class="flex flex-col items-center gap-1 text-gray-700 hover:text-primary active:scale-95 transition">
        <span class="material-symbols-outlined text-2xl">palette</span>
        <span class="text-xs font-medium">Color</span>
      </button>

      <button data-action="bgColor" class="flex flex-col items-center gap-1 text-gray-700 hover:text-primary active:scale-95 transition">
        <span class="material-symbols-outlined text-2xl">format_color_fill</span>
        <span class="text-xs font-medium">BG</span>
      </button>

      <button data-action="border" class="flex flex-col items-center gap-1 text-gray-700 hover:text-primary active:scale-95 transition">
        <span class="material-symbols-outlined text-2xl">border_outer</span>
        <span class="text-xs font-medium">Border</span>
      </button>

         <button data-action="addCard" class="flex flex-col items-center gap-1 text-primary hover:text-blue-700 active:scale-95 transition">
        <span class="material-symbols-outlined text-2xl">add_card</span>
        <span class="text-xs font-medium">New</span>
      </button>
    </div>
  </div>

  <!-- Ultra-Minimal Floating Picker -->
  <div id="pickerOverlay" class="fixed inset-0 z-50 hidden flex items-end pointer-events-none bg-black/40">
    <div class="w-full pointer-events-auto px-4 pb-12">
      <div class="overflow-x-auto whitespace-nowrap scrollbar-hide py-4 px-6">
        <div id="pickerContent" class="inline-flex gap-5"></div>
      </div>
    </div>
  </div>

  <!-- Edit Sheet -->
  <div id="editSheet" class="fixed inset-0 bg-black/50 z-50 hidden flex items-end">
    <div class="w-full bg-white rounded-t-3xl p-6 max-h-[80vh] overflow-y-auto">
      <div class="flex justify-between mb-6">
        <h2 class="text-2xl font-bold"></h2>
        <button id="closeEdit" class="w-10 h-10 rounded-full hover:bg-gray-100">Ok</button>
      </div>
      <input id="title" type="text" class="w-full px-4 py-3 rounded-xl bg-gray-100 mb-4 text-xl" placeholder="Title" />
      <textarea id="content" rows="5" class="w-full px-4 py-3 rounded-xl bg-gray-100 mb-4" placeholder="Content"></textarea>
      <input id="watermarkText" type="text" placeholder="Watermark (optional)" class="w-full px-4 py-3 rounded-xl bg-gray-100" />
    </div>
  </div>

  <script>
    // Card Data
    let cards = [{
      title: "FlashCard Maker",
      content: "Simply enter your Title and Content, choose your color, font, and background, then click Download—you’re done!",
      watermark: "",
      font: "elegant",
      textColor: "#ffffff",
      bg: "from-purple-600 to-pink-600",
      aspect: "aspect-3-4",
      borderWidth: "4",
      borderColor: "transparent",
      shadowIntensity: "none"
    }];
    let currentCardIndex = 0;

    // Elements
    const previewTitle = document.getElementById('previewTitle');
    const previewContent = document.getElementById('previewContent');
    const watermarkContainer = document.getElementById('watermark');
    const watermarkSpan = watermarkContainer.querySelector('span');
    const bgLayer = document.getElementById('bgLayer');
    const cardPreview = document.getElementById('cardPreview');

    const titleInput = document.getElementById('title');
    const contentInput = document.getElementById('content');
    const watermarkInput = document.getElementById('watermarkText');

    const pickerOverlay = document.getElementById('pickerOverlay');
    const pickerContent = document.getElementById('pickerContent');

    const prevOverlay = document.getElementById('prevOverlay');
    const nextOverlay = document.getElementById('nextOverlay');
    const downloadBtn = document.getElementById('downloadBtn');

    // Options (same as before)
    const fonts = [
      { class: "elegant", label: "PlayFair" },
      { class: "serif", label: "MW" },
      { class: "display", label: "Inter" },
      { class: "mono", label: "Roboto" }
    ];

    const textColors = [
      "#ffffff", "#f0f0f0", "#d0d0d0", "#a0a0a0", "#1f2937",
      "#ff0f44", "#ff6f00", "#ffd000", "#00ff85", "#00ffff",
      "#0066ff", "#8a2be2", "#ff33cc", "#ec4899", "#f59e0b",
      "#10b981", "#3b82f6", "#8b5cf6", "#84cc16", "#fb7185"
    ];

    const backgroundOptions = [
      { bg: "from-purple-600 to-pink-600", color: "#a855f7" },
      { bg: "from-red-600 to-orange-600", color: "#f97316" },
      { bg: "from-yellow-500 to-lime-500", color: "#eab308" },
      { bg: "from-cyan-500 to-blue-600", color: "#06b6d4" },
      { bg: "from-indigo-600 to-purple-700", color: "#6366f1" },
      { bg: "from-teal-600 to-emerald-600", color: "#10b981" },
      { bg: "from-gray-800 to-black", color: "#1f2937" },
      { bg: "from-pink-500 to-rose-500", color: "#ec4899" },
      { bg: "from-orange-500 to-red-500", color: "#f97316" },
      { bg: "from-blue-500 to-teal-500", color: "#3b82f6" },
      { bg: "from-green-500 to-emerald-600", color: "#10b981" },
      { bg: "from-fuchsia-600 to-purple-600", color: "#c026d3" },
      { bg: "from-amber-400 to-orange-600", color: "#f59e0b" },
      { bg: "from-sky-400 to-indigo-600", color: "#0ea5e9" },
      { bg: "from-violet-500 to-purple-600", color: "#8b5cf6" },
      { bg: "from-lime-400 to-green-600", color: "#84cc16" },
      { bg: "from-rose-400 to-pink-600", color: "#fb7185" },
      { bg: "from-slate-600 to-gray-900", color: "#475569" }
    ];

    const borders = [
      { width: "0", label: "None" },
      { width: "4", label: "Thin" },
      { width: "8", label: "Medium" },
      { width: "16", label: "Thick" }
    ];

    const aspects = [
      { class: "aspect-1-1", label: "1:1" },
      { class: "aspect-3-4", label: "3:4" },
      { class: "aspect-16-9", label: "16:9" },
      { class: "aspect-9-16", label: "9:16" }
    ];

    // Dynamic Font Sizing
    function getTitleSize(aspect) {
      if (aspect === "aspect-9-16") return "text-4xl";
      if (aspect === "aspect-16-9") return "text-6xl";
      return "text-5xl";
    }

    function getContentSize(aspect) {
      if (aspect === "aspect-9-16") return "text-base";
      if (aspect === "aspect-16-9") return "text-xl";
      return "text-lg";
    }

    // Update Preview
    function updatePreview() {
      const c = cards[currentCardIndex];
      previewTitle.textContent = c.title || '';
      previewContent.textContent = c.content || '';

      previewTitle.className = `font-bold leading-tight font-${c.font} ${getTitleSize(c.aspect)}`;
      previewContent.className = `mt-6 font-medium leading-relaxed font-${c.font} ${getContentSize(c.aspect)}`;

      previewTitle.style.color = c.textColor;
      previewContent.style.color = c.textColor;

      const shadow = c.shadowIntensity === 'none' ? 'none' : 
        `0 ${c.shadowIntensity === 'light' ? '4px 12px' : c.shadowIntensity === 'medium' ? '8px 24px' : '12px 40px'} rgba(0,0,0,0.8)`;
      previewTitle.style.textShadow = shadow;
      previewContent.style.textShadow = shadow;

      if (c.watermark) {
        watermarkSpan.textContent = c.watermark;
        watermarkContainer.classList.remove('hidden');
      } else {
        watermarkContainer.classList.add('hidden');
      }

      bgLayer.className = `absolute inset-0 bg-gradient-to-br ${c.bg}`;

      cardPreview.classList.remove('aspect-1-1', 'aspect-3-4', 'aspect-16-9', 'aspect-9-16');
      cardPreview.classList.remove('border-0', 'border-4', 'border-8', 'border-16', 'border-solid');

      cardPreview.classList.add(c.aspect);

      if (c.borderWidth === '0') {
        cardPreview.classList.add('border-0');
      } else {
        cardPreview.classList.add(`border-${c.borderWidth}`, 'border-solid');
      }

      cardPreview.style.borderColor = c.borderColor;

      // Update UI state (arrows visibility)
      updateUIState();
    }

    // Update UI State (arrows show only with 2+ cards)
    function updateUIState() {
      const hasMultiple = cards.length > 1;
      cardPreview.classList.toggle('has-multiple', hasMultiple);

      if (hasMultiple) {
        prevOverlay.disabled = currentCardIndex === 0;
        nextOverlay.disabled = currentCardIndex === cards.length - 1;
      }
    }

    // Picker Button Creator
    function createPickerButton(item, isSelected, callback) {
      const btn = document.createElement('button');
      btn.className = "w-14 h-14 rounded-full flex items-center justify-center relative shrink-0 transition-all hover:scale-115";

      if (item.color) {
        btn.style.backgroundColor = item.color;
        btn.classList.add("shadow-lg", "ring-4", "ring-white/30");
      } else {
        btn.className += " bg-white/40 backdrop-blur-sm text-white text-xs font-semibold border border-white/40 shadow-md";
        btn.textContent = item.label;
      }

      if (isSelected) {
        const check = document.createElement('span');
        check.textContent = "✓";
        check.className = "absolute text-white text-xl font-bold drop-shadow-lg pointer-events-none";
        btn.appendChild(check);
      }

      btn.onclick = () => {
        callback(item);
        pickerOverlay.classList.add('hidden');
        updatePreview();
      };
      return btn;
    }

    // Open Picker
    function openPicker(items, currentValue, getKey, callback, representativeColor = null) {
      pickerContent.innerHTML = '';
      items.forEach(item => {
        const key = representativeColor ? getKey(item) : (item.color || getKey(item));
        const isSelected = key === currentValue;
        const btnItem = representativeColor ? { color: representativeColor(item) } : item;

        const btn = createPickerButton(btnItem, isSelected, () => {
          callback(item);
          pickerOverlay.classList.add('hidden');
          updatePreview();
        });
        pickerContent.appendChild(btn);
      });
      pickerOverlay.classList.remove('hidden');
    }

    // Close Picker on Outside Tap
    pickerOverlay.addEventListener('click', (e) => {
      if (e.target === pickerOverlay) pickerOverlay.classList.add('hidden');
    });

    // Action Buttons
    document.querySelectorAll('[data-action]').forEach(btn => {
      btn.addEventListener('click', () => {
        const action = btn.dataset.action;
        const c = cards[currentCardIndex];

        if (action === 'edit') {
          titleInput.value = c.title;
          contentInput.value = c.content;
          watermarkInput.value = c.watermark || '';
          document.getElementById('editSheet').classList.remove('hidden');
        } 
        else if (action === 'font') {
          openPicker(fonts, c.font, i => i.class, f => c.font = f.class);
        } 
        else if (action === 'textColor') {
          openPicker(textColors.map(col => ({color: col})), c.textColor, i => i.color, tc => c.textColor = tc.color);
        } 
        else if (action === 'bgColor') {
          openPicker(backgroundOptions, c.bg, i => i.bg, b => c.bg = b.bg, i => i.color);
        } 
        else if (action === 'border') {
          openPicker(borders, c.borderWidth, i => i.width, b => c.borderWidth = b.width);
        } 
        else if (action === 'aspect') {
          openPicker(aspects, c.aspect, i => i.class, a => c.aspect = a.class);
        } 
        else if (action === 'addCard') {
          cards.push({
            title: "",
            content: "",
            watermark: "",
            font: c.font,
            textColor: c.textColor,
            bg: c.bg,
            aspect: c.aspect,
            borderWidth: c.borderWidth,
            borderColor: c.borderColor,
            shadowIntensity: c.shadowIntensity
          });
          currentCardIndex = cards.length - 1;
          updatePreview(); // This calls updateUIState()
        }
      });
    });

    // Close Edit Sheet
    document.getElementById('closeEdit').addEventListener('click', () => {
      document.getElementById('editSheet').classList.add('hidden');
      updatePreview();
    });

    // Live Updates from Edit Sheet
    titleInput.addEventListener('input', () => { cards[currentCardIndex].title = titleInput.value; updatePreview(); });
    contentInput.addEventListener('input', () => { cards[currentCardIndex].content = contentInput.value; updatePreview(); });
    watermarkInput.addEventListener('input', () => { cards[currentCardIndex].watermark = watermarkInput.value; updatePreview(); });


downloadBtn.addEventListener('click', () => {
  // 1. Hide unwanted elements
  const originalPrevDisplay = prevOverlay.style.display;
  const originalNextDisplay = nextOverlay.style.display;
  const originalDownloadDisplay = downloadBtn.style.display;

  prevOverlay.style.display = 'none';
  nextOverlay.style.display = 'none';
  downloadBtn.style.display = 'none';

  // 2. Capture
  html2canvas(cardPreview, { scale: 2 }).then(canvas => {
    canvas.toBlob(blob => {
      const link = document.createElement('a');
      link.download = (cards[currentCardIndex].title || 'flashcard') + '.png';
      link.href = URL.createObjectURL(blob);
      link.click();

      // 3. Restore visibility immediately after
      prevOverlay.style.display = originalPrevDisplay;
      nextOverlay.style.display = originalNextDisplay;
      downloadBtn.style.display = originalDownloadDisplay;
    });
  });
});

    // Overlay Navigation
    prevOverlay.addEventListener('click', () => {
      if (currentCardIndex > 0) {
        currentCardIndex--;
        updatePreview();
      }
    });

    nextOverlay.addEventListener('click', () => {
      if (currentCardIndex < cards.length - 1) {
        currentCardIndex++;
        updatePreview();
      }
    });

    // Download
    downloadBtn.addEventListener('click', () => {
      html2canvas(cardPreview, { scale: 2 }).then(canvas => {
        canvas.toBlob(blob => {
          const link = document.createElement('a');
          link.download = (cards[currentCardIndex].title || 'flashcard') + '.png';
          link.href = URL.createObjectURL(blob);
          link.click();
        });
      });
    });

    // Initial Render
    updatePreview();
  </script>
</body>
</html>