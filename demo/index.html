<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flashcard Generator</title>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;700&family=Roboto+Mono:wght@400;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,0..200" rel="stylesheet" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- html2canvas for download -->
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#3b82f6",
          },
          fontFamily: {
            display: ["Inter", "sans-serif"],
            serif: ["Merriweather", "serif"],
            mono: ["Roboto Mono", "monospace"],
            elegant: ["Playfair Display", "serif"],
          },
        },
      },
    }
  </script>

  <style>
    body { min-height: 100dvh; }
    .aspect-1-1 { aspect-ratio: 1/1; }
    .aspect-3-4 { aspect-ratio: 3/4; }
    .aspect-16-9 { aspect-ratio: 16/9; }
    .aspect-9-16 { aspect-ratio: 9/16; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>

<body class="bg-gray-100 flex flex-col">

  <!-- Preview Area -->
  <main class="flex-1 flex flex-col items-center justify-center p-8 pb-24">
    <div id="cardPreview" class="relative max-w-lg w-full bg-white rounded-3xl shadow-2xl overflow-hidden aspect-3-4 border-4 border-transparent">
      <div id="bgLayer" class="absolute inset-0 bg-gradient-to-br from-purple-600 to-pink-600"></div>
      <div class="absolute inset-0 bg-white/10 backdrop-blur-[4px]"></div>

      <div class="relative z-10 flex flex-col justify-center items-center h-full px-8 py-12 text-center">
        <h1 id="previewTitle" class="font-bold leading-tight font-elegant text-white">
          Photosynthesis
        </h1>
        <p id="previewContent" class="mt-6 font-medium leading-relaxed font-display text-white">
          The process by which green plants and some other organisms use sunlight to synthesize foods from carbon dioxide and water.
        </p>
      </div>

      <div id="watermark" class="absolute bottom-4 left-4 opacity-50 hidden">
        <span class="text-lg font-bold text-white">@henry</span>
      </div>
    </div>

    <!-- Download Button -->
    <button id="downloadBtn" class="mt-8 w-16 h-16 bg-white/90 backdrop-blur rounded-full shadow-2xl flex items-center justify-center hover:scale-110 active:scale-95 transition">
      <span class="material-symbols-outlined text-4xl text-primary">download</span>
    </button>
  </main>

  <!-- FAB Menu -->
  <div class="fixed bottom-6 right-6 z-40">
    <div class="flex flex-col items-center gap-3">
      <div id="fabMenu" class="flex flex-col-reverse gap-3 mb-3 transition-all duration-300 opacity-0 scale-95 pointer-events-none">
        <button data-action="edit" class="w-14 h-14 bg-white/90 backdrop-blur rounded-full shadow-xl flex items-center justify-center hover:scale-110">
          <span class="material-symbols-outlined text-2xl">edit_note</span>
        </button>
        <button data-action="font" class="w-14 h-14 bg-white/90 backdrop-blur rounded-full shadow-xl flex items-center justify-center hover:scale-110">
          <span class="material-symbols-outlined text-2xl">text_fields</span>
        </button>
        <button data-action="textColor" class="w-14 h-14 bg-white/90 backdrop-blur rounded-full shadow-xl flex items-center justify-center hover:scale-110">
          <span class="material-symbols-outlined text-2xl">palette</span>
        </button>
        <button data-action="textShadow" class="w-14 h-14 bg-white/90 backdrop-blur rounded-full shadow-xl flex items-center justify-center hover:scale-110">
          <span class="material-symbols-outlined text-2xl">format_color_text</span>
        </button>
        <button data-action="bgColor" class="w-14 h-14 bg-white/90 backdrop-blur rounded-full shadow-xl flex items-center justify-center hover:scale-110">
          <span class="material-symbols-outlined text-2xl">format_color_fill</span>
        </button>
        <button data-action="border" class="w-14 h-14 bg-white/90 backdrop-blur rounded-full shadow-xl flex items-center justify-center hover:scale-110">
          <span class="material-symbols-outlined text-2xl">border_outer</span>
        </button>
        <button data-action="aspect" class="w-14 h-14 bg-white/90 backdrop-blur rounded-full shadow-xl flex items-center justify-center hover:scale-110">
          <span class="material-symbols-outlined text-2xl">aspect_ratio</span>
        </button>
        <button data-action="addCard" class="w-14 h-14 bg-white/90 backdrop-blur rounded-full shadow-xl flex items-center justify-center hover:scale-110">
          <span class="material-symbols-outlined text-2xl">add_card</span>
        </button>
      </div>

      <button id="mainFab" class="w-16 h-16 bg-primary text-white rounded-full shadow-2xl flex items-center justify-center active:scale-95">
        <span id="fabIcon" class="material-symbols-outlined text-4xl">add</span>
      </button>
    </div>
  </div>

  <!-- Ultra-Minimal Floating Picker -->
  <div id="pickerOverlay" class="fixed inset-0 z-50 hidden flex items-end pointer-events-none bg-black/40">
    <div class="w-full pointer-events-auto px-4 pb-12">
      <div class="overflow-x-auto whitespace-nowrap scrollbar-hide py-4 px-6">
        <div id="pickerContent" class="inline-flex gap-5"></div>
      </div>
    </div>
  </div>

  <!-- Edit Sheet -->
  <div id="editSheet" class="fixed inset-0 bg-black/50 z-50 hidden flex items-end">
    <div class="w-full bg-white rounded-t-3xl p-6 max-h-[80vh] overflow-y-auto">
      <div class="flex justify-between mb-6">
        <h2 class="text-2xl font-bold">Edit Text</h2>
        <button id="closeEdit" class="w-10 h-10 rounded-full hover:bg-gray-100">close</button>
      </div>
      <input id="title" type="text" value="Photosynthesis" class="w-full px-4 py-3 rounded-xl bg-gray-100 mb-4 text-xl" placeholder="Title" />
      <textarea id="content" rows="5" class="w-full px-4 py-3 rounded-xl bg-gray-100 mb-4" placeholder="Content">
The process by which green plants and some other organisms use sunlight to synthesize foods from carbon dioxide and water.</textarea>
      <input id="watermarkText" type="text" placeholder="Watermark (optional)" class="w-full px-4 py-3 rounded-xl bg-gray-100" />
    </div>
  </div>

  <script>
    // Card Data
    let cards = [{
      title: "Photosynthesis",
      content: "The process by which green plants and some other organisms use sunlight to synthesize foods from carbon dioxide and water.",
      watermark: "",
      font: "elegant",
      textColor: "#ffffff",
      bg: "from-purple-600 to-pink-600",
      aspect: "aspect-3-4",
      borderWidth: "4",
      borderColor: "transparent",
      shadowIntensity: "none"
    }];
    let currentCardIndex = 0;

    // Elements
    const previewTitle = document.getElementById('previewTitle');
    const previewContent = document.getElementById('previewContent');
    const watermarkContainer = document.getElementById('watermark');
    const watermarkSpan = watermarkContainer.querySelector('span');
    const bgLayer = document.getElementById('bgLayer');
    const cardPreview = document.getElementById('cardPreview');

    const titleInput = document.getElementById('title');
    const contentInput = document.getElementById('content');
    const watermarkInput = document.getElementById('watermarkText');

    const mainFab = document.getElementById('mainFab');
    const fabIcon = document.getElementById('fabIcon');
    const fabMenu = document.getElementById('fabMenu');

    const pickerOverlay = document.getElementById('pickerOverlay');
    const pickerContent = document.getElementById('pickerContent');

    let isOpen = false;

    // Options
    const fonts = [
      { class: "elegant", label: "Playfair Display" },
      { class: "serif", label: "Merriweather" },
      { class: "display", label: "Inter" },
      { class: "mono", label: "Roboto Mono" }
    ];

    const textColors = [
      "#ffffff", "#f0f0f0", "#d0d0d0", "#a0a0a0", "#1f2937",
      "#ff0f44", "#ff6f00", "#ffd000", "#00ff85", "#00ffff",
      "#0066ff", "#8a2be2", "#ff33cc", "#ec4899", "#f59e0b",
      "#10b981", "#3b82f6", "#8b5cf6", "#84cc16", "#fb7185"
    ];

    const shadows = [
      { value: "none", label: "Off" },
      { value: "light", label: "Light" },
      { value: "medium", label: "Medium" },
      { value: "strong", label: "Strong" }
    ];

    const backgroundOptions = [
      { bg: "from-purple-600 to-pink-600", color: "#a855f7" },
      { bg: "from-red-600 to-orange-600", color: "#f97316" },
      { bg: "from-yellow-500 to-lime-500", color: "#eab308" },
      { bg: "from-cyan-500 to-blue-600", color: "#06b6d4" },
      { bg: "from-indigo-600 to-purple-700", color: "#6366f1" },
      { bg: "from-teal-600 to-emerald-600", color: "#10b981" },
      { bg: "from-gray-800 to-black", color: "#1f2937" },
      { bg: "from-pink-500 to-rose-500", color: "#ec4899" },
      { bg: "from-orange-500 to-red-500", color: "#f97316" },
      { bg: "from-blue-500 to-teal-500", color: "#3b82f6" },
      { bg: "from-green-500 to-emerald-600", color: "#10b981" },
      { bg: "from-fuchsia-600 to-purple-600", color: "#c026d3" },
      { bg: "from-amber-400 to-orange-600", color: "#f59e0b" },
      { bg: "from-sky-400 to-indigo-600", color: "#0ea5e9" },
      { bg: "from-violet-500 to-purple-600", color: "#8b5cf6" },
      { bg: "from-lime-400 to-green-600", color: "#84cc16" },
      { bg: "from-rose-400 to-pink-600", color: "#fb7185" },
      { bg: "from-slate-600 to-gray-900", color: "#475569" }
    ];

    const borders = [
      { width: "0", label: "None" },
      { width: "4", label: "Thin" },
      { width: "8", label: "Medium" },
      { width: "16", label: "Thick" }
    ];

    const aspects = [
      { class: "aspect-1-1", label: "1:1" },
      { class: "aspect-3-4", label: "3:4" },
      { class: "aspect-16-9", label: "16:9" },
      { class: "aspect-9-16", label: "9:16" }
    ];

    // Dynamic Font Sizing
    function getTitleSize(aspect) {
      if (aspect === "aspect-9-16") return "text-4xl";
      if (aspect === "aspect-16-9") return "text-6xl";
      return "text-5xl";
    }

    function getContentSize(aspect) {
      if (aspect === "aspect-9-16") return "text-base";
      if (aspect === "aspect-16-9") return "text-xl";
      return "text-lg";
    }

    // Update Preview
    function updatePreview() {
      const c = cards[currentCardIndex];
      previewTitle.textContent = c.title || 'Title';
      previewContent.textContent = c.content || 'Content';

      previewTitle.className = `font-bold leading-tight font-${c.font} ${getTitleSize(c.aspect)}`;
      previewContent.className = `mt-6 font-medium leading-relaxed font-${c.font} ${getContentSize(c.aspect)}`;

      previewTitle.style.color = c.textColor;
      previewContent.style.color = c.textColor;

      const shadow = c.shadowIntensity === 'none' ? 'none' : 
        `0 ${c.shadowIntensity === 'light' ? '4px 12px' : c.shadowIntensity === 'medium' ? '8px 24px' : '12px 40px'} rgba(0,0,0,0.8)`;
      previewTitle.style.textShadow = shadow;
      previewContent.style.textShadow = shadow;

      if (c.watermark) {
        watermarkSpan.textContent = c.watermark;
        watermarkContainer.classList.remove('hidden');
      } else {
        watermarkContainer.classList.add('hidden');
      }

      bgLayer.className = `absolute inset-0 bg-gradient-to-br ${c.bg}`;

      // Fixed class management
      cardPreview.classList.remove('aspect-1-1', 'aspect-3-4', 'aspect-16-9', 'aspect-9-16');
      cardPreview.classList.remove('border-0', 'border-4', 'border-8', 'border-16', 'border-solid');

      cardPreview.classList.add(c.aspect);

      if (c.borderWidth === '0') {
        cardPreview.classList.add('border-0');
      } else {
        cardPreview.classList.add(`border-${c.borderWidth}`, 'border-solid');
      }

      cardPreview.style.borderColor = c.borderColor;
    }

    // Picker Button Creator
    function createPickerButton(item, isSelected, callback) {
      const btn = document.createElement('button');
      btn.className = "w-14 h-14 rounded-full flex items-center justify-center relative shrink-0 transition-all hover:scale-115";

      if (item.color) {
        btn.style.backgroundColor = item.color;
        btn.classList.add("shadow-lg", "ring-4", "ring-white/30");
      } else {
        btn.className += " bg-white/40 backdrop-blur-sm text-white text-xs font-semibold border border-white/40 shadow-md";
        btn.textContent = item.label;
      }

      if (isSelected) {
        const check = document.createElement('span');
        check.textContent = "âœ“";
        check.className = "absolute text-white text-xl font-bold drop-shadow-lg pointer-events-none";
        btn.appendChild(check);
      }

      btn.onclick = () => {
        callback(item);
        pickerOverlay.classList.add('hidden');
        updatePreview();
      };
      return btn;
    }

       // Open Picker - FIXED VERSION
    function openPicker(items, currentValue, getKey, callback, representativeColor = null) {
      pickerContent.innerHTML = '';
      items.forEach(item => {
        let key;
        if (representativeColor) {
          key = getKey(item);  // Use actual property for selection matching
        } else {
          key = item.color || getKey(item);
        }
        const isSelected = key === currentValue;

        const btnItem = representativeColor ? { color: representativeColor(item) } : item;

        const btn = createPickerButton(btnItem, isSelected, () => {
          callback(item);  // Pass original item to callback
          pickerOverlay.classList.add('hidden');
          updatePreview();
        });

        pickerContent.appendChild(btn);
      });
      pickerOverlay.classList.remove('hidden');
    }

    // Close Picker on Outside Tap
    pickerOverlay.addEventListener('click', (e) => {
      if (e.target === pickerOverlay) {
        pickerOverlay.classList.add('hidden');
      }
    });

    // FAB Toggle
    mainFab.addEventListener('click', () => {
      isOpen = !isOpen;
      if (isOpen) {
        fabMenu.classList.remove('opacity-0', 'scale-95', 'pointer-events-none');
        fabMenu.classList.add('opacity-100', 'scale-100', 'pointer-events-auto');
        fabIcon.textContent = 'close';
      } else {
        fabMenu.classList.add('opacity-0', 'scale-95', 'pointer-events-none');
        fabMenu.classList.remove('opacity-100', 'scale-100', 'pointer-events-auto');
        fabIcon.textContent = 'add';
      }
    });

    // Action Buttons
    document.querySelectorAll('#fabMenu button[data-action]').forEach(btn => {
      btn.addEventListener('click', () => {
        const action = btn.dataset.action;
        const c = cards[currentCardIndex];

        if (action === 'edit') {
          titleInput.value = c.title;
          contentInput.value = c.content;
          watermarkInput.value = c.watermark || '';
          document.getElementById('editSheet').classList.remove('hidden');
        } else if (action === 'font') {
          openPicker(fonts, c.font, i => i.class, (f) => c.font = f.class);
        } else if (action === 'textColor') {
          openPicker(textColors.map(col => ({color: col})), c.textColor, i => i.color, (tc) => c.textColor = tc.color);
        } else if (action === 'textShadow') {
          openPicker(shadows, c.shadowIntensity, i => i.value, (s) => c.shadowIntensity = s.value);
        } else if (action === 'bgColor') {
          openPicker(backgroundOptions, c.bg, i => i.bg, (b) => c.bg = b.bg, i => i.color);
        } else if (action === 'border') {
          openPicker(borders, c.borderWidth, i => i.width, (b) => c.borderWidth = b.width);
        } else if (action === 'aspect') {
          openPicker(aspects, c.aspect, i => i.class, (a) => c.aspect = a.class);
        } else if (action === 'addCard') {
          cards.push({
            title: "",
            content: "",
            watermark: "",
            font: c.font,
            textColor: c.textColor,
            bg: c.bg,
            aspect: c.aspect,
            borderWidth: c.borderWidth,
            borderColor: c.borderColor,
            shadowIntensity: c.shadowIntensity
          });
          currentCardIndex = cards.length - 1;
          updatePreview();
        }
        mainFab.click(); // close menu
      });
    });

    // Close Edit Sheet
    document.getElementById('closeEdit').addEventListener('click', () => {
      document.getElementById('editSheet').classList.add('hidden');
      updatePreview(); // apply changes if any
    });

    // Live Updates from Edit Sheet
    titleInput.addEventListener('input', () => {
      cards[currentCardIndex].title = titleInput.value;
      updatePreview();
    });
    contentInput.addEventListener('input', () => {
      cards[currentCardIndex].content = contentInput.value;
      updatePreview();
    });
    watermarkInput.addEventListener('input', () => {
      cards[currentCardIndex].watermark = watermarkInput.value;
      updatePreview();
    });

    // Download
    document.getElementById('downloadBtn').addEventListener('click', () => {
      html2canvas(cardPreview, { scale: 2 }).then(canvas => {
        canvas.toBlob(blob => {
          const link = document.createElement('a');
          link.download = (cards[currentCardIndex].title || 'flashcard') + '.png';
          link.href = URL.createObjectURL(blob);
          link.click();
        });
      });
    });

    // Initial Render
    updatePreview();
  </script>
</body>
</html>